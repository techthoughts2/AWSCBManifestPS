<?xml version="1.0" encoding="utf-8"?>
<plasterManifest schemaVersion="1.1" templateType="Project"
  xmlns="http://www.microsoft.com/schemas/PowerShell/Plaster/v1">
  <metadata>
    <name>AWSCBManifestPS</name>
    <id>83670531-579c-4a4c-a70a-ddc60eaefa40</id>
    <version>0.8.1</version>
    <title>New PowerShell Module for AWS CB</title>
    <description>Scaffolds a new PowerShell module project intended for CI/CD workflow using AWS CodeBuild</description>
    <author>Jake Morrison</author>
    <tags>AWS,PowerShell,CodeBuild,PowerShell Module,Build</tags>
  </metadata>
  <parameters>
    <parameter name='ModuleName' type='text' prompt='Enter the name of the module'/>
    <parameter name='Version' type='text' prompt='Enter the version number of the module' default='0.0.1'/>
    <parameter name='RepoType' type='choice' default='0' store='text' prompt='Where will this project be hosted?'>
      <choice label='&amp;GitHub ' help="Hosted on GitHub." value="GITHUB"/>
      <choice label='&amp;AWS CodeCommit' help="Hosted on AWS CodeCommit." value="CC"/>
    </parameter>
    <parameter name='GitIgnore' type='choice' default='0' store='text' prompt='Would you like to generate a .gitignore file?'>
      <choice label='&amp;gitignore' help="Adds a.gitignore file." value="GIT"/>
      <choice label='&amp;None' help="Does not add a.gitignore file." value="NOGIT"/>
    </parameter>
    <parameter name='S3Bucket' type='text' prompt='Enter S3 bucket name to download needed PS modules from S3 location. Leave blank to DL modules from PSGallery.' default='PSGallery'/>
    <parameter name='Options' type='multichoice' default='1,2' store='text' prompt='Select desired buildpsec file options?'>
      <choice label='&amp;Windows - PowerShell'
              help="Adds a powershell focused buildspec.yml for Windows CodeBuild."
              value="ps"/>
      <choice label='&amp;Core (Windows)- pwsh'
              help="Adds a pwsh focused buildspec.yml for Windows CodeBuild."
              value="pwshcore"/>
      <choice label='&amp;Linux - pwsh'
              help="Adds a pwsh focused buildspec.yml for Linux CodeBuild."
              value="pwsh"/>
      <choice label='&amp;None'
              help="Does not add a buildspec file."
              value="None"/>
    </parameter>
  </parameters>
  <content>
    <message>&#10;&#10;Scaffolding your PowerShell Module for AWS CB...&#10;&#10;&#10;</message>
    <file source='' destination='docs'/>
    <file source='' destination='media'/>
    <file source='' destination='src'/>
    <file source='' destination='CloudFormation'/>
    <file source='' destination='src\Archive'/>
    <file source='' destination='src\Artifacts'/>
    <file source='' destination='src\Tests'/>
    <file source='' destination='src\Tests\Infrastrcuture'/>
    <file source='' destination='src\Tests\Unit'/>
    <file source='' destination='src\${PLASTER_PARAM_ModuleName}'/>
    <file source='' destination='src\${PLASTER_PARAM_ModuleName}\Public'/>
    <file source='' destination='src\${PLASTER_PARAM_ModuleName}\Private'/>
    <file source='editor\VSCode\tasks.json' destination='.vscode\tasks.json' />
    <file source='editor\VSCode\settings.json' destination='.vscode\settings.json' />

    <templateFile source='src\test\PSModule-Module.Tests.ps1' destination='src\Tests\Unit\${PLASTER_PARAM_ModuleName}-Module.Tests.ps1' />
    <templateFile source='src\test\ExportedFunctions.Tests.ps1' destination='src\Tests\Unit\ExportedFunctions.Tests.ps1' />

    <file source='src\PSModule.build.ps1' destination='src\${PLASTER_PARAM_ModuleName}.build.ps1'/>
    <file source='src\PSModule.Settings.ps1' destination='src\${PLASTER_PARAM_ModuleName}.Settings.ps1'/>
    <file source='configure_aws_credential.ps1' destination='configure_aws_credential.ps1'/>

    <file condition="$PLASTER_PARAM_GitIgnore -eq 'GIT'" source='.gitignore' destination='.gitignore' />
    <templateFile condition="$PLASTER_PARAM_Options -eq 'ps'" source='buildspec_powershell_windows.yml' destination='buildspec_powershell_windows.yml' />
    <templateFile condition="$PLASTER_PARAM_Options -eq 'pwshcore'" source='buildspec_pwsh_windows.yml' destination='buildspec_pwsh_windows.yml' />
    <templateFile condition="$PLASTER_PARAM_Options -eq 'pwsh'" source='buildspec_pwsh_linux.yml' destination='buildspec_pwsh_linux.yml' />
    <templateFile source='install_modules.ps1' destination='install_modules.ps1'/>
    <templateFile condition="$PLASTER_PARAM_RepoType -eq 'GITHUB'" source='CloudFormation\PowerShellCodeBuildGit.yml' destination='CloudFormation\PowerShellCodeBuildGit.yml'/>
    <templateFile condition="$PLASTER_PARAM_RepoType -eq 'CC'" source='CloudFormation\PowerShellCodeBuildCC.yml' destination='CloudFormation\PowerShellCodeBuildCC.yml'/>

    <newModuleManifest destination='src\${PLASTER_PARAM_ModuleName}\${PLASTER_PARAM_ModuleName}.psd1' moduleVersion='$PLASTER_PARAM_Version' rootModule='${PLASTER_PARAM_ModuleName}.psm1' encoding='UTF8-NoBOM' openInEditor="true"/>
    <file source='Module.psm1' destination='src\${PLASTER_PARAM_ModuleName}\${PLASTER_PARAM_ModuleName}.psm1' openInEditor="true"/>


    <requireModule name="Pester" minimumVersion="4.5.0" message="Without Pester, you will not be able to run the provided Pester test to validate your module manifest file.`nWithout version 4.5.0, VS Code will not display Pester warnings and errors in the Problems panel."/>
    <message>

Your new PowerShell module project '$PLASTER_PARAM_ModuleName' has been created.

    </message>

    <message>
A Pester test has been created to validate the module's manifest file.  Add additional tests to the test directory.
You can run the Pester tests in your project by executing the 'test' task.  Press Ctrl+P, then type 'task test'.
S3 BucketNames references will need to be changed to your own S3 BucketNames.
    </message>
  </content>
</plasterManifest>